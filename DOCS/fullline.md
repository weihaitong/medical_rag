一、总体架构理念
医疗知识具有 两种本质结构：

数据类型	特点	最适合的存储	在 RAG 中作用
结构化知识（三元组、规则、字段）	可明确抽取为实体-关系	图数据库（Neo4j）	医学推理、知识联想、可解释因果
非结构化知识（自由文本）	大段叙述、模糊描述、案例	向量数据库（Qdrant / Milvus）	语义相似检索、病例类问答

因此，我们采用 “图数据库 = 逻辑脑”，向量数据库 = 长期语义记忆” 存储架构。

二、数据入库决策原则
1. 结构化 vs 非结构化 判断三原则
    核心不是看“格式”或“字数”，而是看“语义可解析性”。
    判断一段内容是否结构化的三条黄金规则：
        是否能无歧义抽取 <主体, 关系, 客体>？
        是否具备明显字段、属性或固定模板？
        信息是否原子、可复用？

    符合 → 图数据库
    不符合 → 向量数据库
    部分符合 → 拆分双存储

2. 拆分双存储策略
    若内容同时包含结构化与叙述：
    内容部分	入库位置
    可抽取的三元组	Neo4j（图数据库）
    原始段落文本	向量数据库（向量）
        例如：药品说明书
        成分、禁忌、适应症 → 图数据库
        作用机制、注意事项长描述 → 向量库
        目的：不丢信息，同时可实现推理 + 语义匹配。

三、数据来源分类与对应入库策略


| 数据来源                 | 图数据库                          | 向量数据库                     | 说明                             |
|--------------------------|-----------------------------------|--------------------------------|----------------------------------|
| 医学百科 / 知识库条目     | ✔ 三元组                          | ✔ 原文段落                     | 强结构化，可双存                 |
| 药品说明书               | ✔ 药物属性、禁忌、相互作用         | ✔ 机制/注意长描述               | 最常用双存                       |
| 诊疗规范 / 临床指南       | ✔ 关键逻辑规则                    | ✔ 全文 Embedding               | 向量库帮助长文检索               |
| 医学文献                 | ❌                                | ✔ 长文本                       | 文献几乎完全非结构化             |
| 病历报告                 | ✔ 可提取键值                      | ✔ 主诉、描述性内容             | 病人主诉必须入向量库             |
| 教科书内容               | ❌                                | ✔ 长篇内容                     | 用于相似检索                     |
四、图数据库（Neo4j）建模规范
    图数据库承载 实体、属性、关系，构成医疗知识的逻辑骨架。
    推荐的核心实体类型
        Disease（疾病）
        Symptom（症状）
        Drug（药物）
        Treatment（治疗方案）
        Examination（检查）
        Contraindication（禁忌）
        Complication（并发症）
    典型关系类型
        Disease —has_symptom→ Symptom
        Drug —treats→ Disease
        Drug —contraindicated_for→ Population/Disease
        Disease —requires→ Examination
        Disease —treated_by→ Treatment

五、向量数据库建模规范
    向量库用于存储 长文本、自由描述、病例、百科原文、指南全文。
    标准表结构（建议）
        id
        source_type         (guideline, literature, case, textbook, drug_label)
        title
        content
        embedding
        metadata(json)
   Embedding 用途
       相似语义检索
       召回病人主诉
       检索指南或说明书
       相关段落
        FAQ 类医疗问题匹配

六、冲突检测与数据一致性机制
    医疗知识需避免冲突或过期内容。
    1. 结构化逻辑一致性检测（图数据库）
    例
        A 药物是否禁用于孕妇？
    三元组冲突示例：
        Drug X → contraindicated_for → Pregnancy
        Drug X → recommended_for → Pregnancy

    需人工或规则消解。
    2. 语义矛盾检测（向量层）
    Embedding 对比：
        肯定 vs 否定
        最新 vs 旧版
    3. 基于来源权威度与时间戳处理
    优先级：
        指南 > 说明书 > 教科书 > 百度百科 > 网络文章

七、双库混合检索策略（核心）
    医疗 RAG 的关键：
    并行检索 → 合并 → 去重 → rerank → LLM 输出
    1. 并行检索
    Input Query
     ├── 图数据库检索（精确实体、关系推理）
     └── 向量数据库检索（语义相似）
    2. 合并 + 去重
    同一个药物、疾病的描述可能来自不同来源
        合并为统一实体
        去除重复文本块
    3. 统一 Reranker（语义重排）
    所有结果（向量库 + 图数据库）一起送入：
        cross-encoder / bge-reranker / colbert-style reranker
    得分越高越相关
        结构化知识因为精准，通常得分更高 → 自然优先，无需手动加权。
   4. LLM 根据高质量上下文生成答案
        模型不“选择库”，而是对融合后的上下文进行推理。

八、为何必须同时保留图数据库与向量数据库？
    图数据库	向量数据库
    逻辑推理强，可解释	语义理解强
    适合结构化医学知识	适合病例描述、模糊主诉
    关系精准	模糊相似
    不懂自然语言	不懂关系推理
       ***两者解决的是完全不同的需求，不可互相替代。

九、判断某段内容应入哪个库：统一决策流程
    若能抽成三元组 → 图数据库
    若主要是故事/描述/主诉 → 向量库
    若两者都符合 → 双存储（推荐）
    若信息含矛盾 → 冲突检测后入库

十、完整医疗 RAG Pipeline（从入库到答案）
                    数据源
   ┌──────────────┴───────────────┐
结构化内容                      非结构化内容
（药品字段/禁忌/三元组）            （指南全文、病历主诉）
   │                                   │
三元组抽取 NLP               文本切块 + Embedding
   │                                   │
图数据库（Neo4j）               向量数据库（Qdrant/Milvus）
   └──────────────┬───────────────┘
             冲突检测（结构逻辑 + 语义矛盾）
   └──────────────┬───────────────┘
               并行检索
              Graph + Vector
                    ↓
               合并 + 去重
                    ↓
              统一 Reranker
                    ↓
               LLM 生成答案




